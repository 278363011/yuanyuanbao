<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuanbaobao.mini.mapper.ProjectDesignMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.yuanbaobao.mini.model.ProjectDesign">
        <id column="id" property="id"/>
        <result column="project_id" property="projectId"/>
        <result column="title_name" property="titleName"/>
        <result column="title_desc" property="titleDesc"/>
        <result column="title_content" property="titleContent"/>
        <result column="integration" property="integration"/>
        <result column="user_view_num" property="userViewNum"/>
        <result column="share_num" property="shareNum"/>
        <result column="exchange_num" property="exchangeNum"/>
        <result column="download_url" property="downloadUrl"/>
        <result column="current_status" property="currentStatus"/>
        <result column="is_hot" property="isHot"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_del" property="isDel"/>
        <result column="lock_version" property="lockVersion"/>
    </resultMap>

    <resultMap id="ProjectDesignVoMap" type="com.yuanbaobao.mini.vo.ProjectDesignResponseVo" extends="BaseResultMap">
        <result column="tags" property="tags"/>
    </resultMap>

    <select id="getDesignList" resultMap="pageMap">
        SELECT *,(SELECT GROUP_CONCAT(pg.tag_name) FROM project_tags AS pg
        LEFT JOIN design_tags_middle AS dtm ON dtm.tag_id = pg.id
        LEFT JOIN project_design AS pd ON pd.id = dtm.design_id WHERE pd.id =psv.`id` GROUP BY pd.id ) AS tags
        FROM `project_design` AS psv
        <where>
            <if test="pdrv.isHot != null and pdrv.isHot != ''">
                psv.`is_hot` = #{pdrv.isHot}
            </if>
        </where>
        <if test="pdrv.orderType != null and pdrv.orderType != ''">
            ORDER BY psv.`order_type` #{ordervo.orderType}
        </if>
    </select>

    <select id="getSelectedDesignList" resultMap="pageMap">
        SELECT psv.*,(SELECT GROUP_CONCAT(pg.tag_name) FROM project_tags AS pg
        LEFT JOIN design_tags_middle AS dtm ON dtm.tag_id = pg.id
        LEFT JOIN project_design AS pd ON pd.id = dtm.design_id WHERE pd.id =psv.`id` GROUP BY pd.id ) AS tags
        FROM `project_design` AS psv
        LEFT JOIN design_category_middle AS dcm ON dcm.`design_id` = psv.`id`
        LEFT JOIN project_category_dic AS pcd ON pcd.`id` = dcm.`cate_id`
        <where>
            <if test="pdrv.isHot != null and pdrv.isHot != ''">
                psv.`is_hot` = #{pdrv.isHot}
            </if>
            <if test="pdrv.cateType != null and pdrv.cateType != ''">
                pcd.`id` = #{pdrv.cateType}
            </if>
            <if test="pdrv.titleContent != null and pdrv.titleContent != ''">
                psv.`title_content` LIKE '%${pdrv.titleContent}%'
            </if>
            <if test="pdrv.orderType != null and pdrv.orderType != ''">
                ORDER BY psv.`order_type` #{ordervo.orderType}
            </if>
        </where>
    </select>


</mapper>
